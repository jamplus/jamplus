<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Multiple Passes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Multiple Passes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="multiple_passes_overview"></a>
Overview</h1>
<p>Stock Jam was built as a highly efficient single pass build system where all targets must be known during the <a class="el" href="jam_language.html#operation_parsing">Parsing Phase</a>. When the <a class="el" href="jam_language.html#operation_updating">Updating Phase</a> is complete, Jam assumed the build is finished and exits.</p>
<p>JamPlus adds a facility to enable multiple passes on the dependency graph, allowing 'unknown' dependencies to be discovered during one pass and handled in the next pass.</p>
<h1><a class="anchor" id="multiple_passes_usage"></a>
Usage</h1>
<p>To initiate a second Jam pass, the <a class="el" href="builtin_rules.html#rule_QueueJamfile">QueueJamfile</a> rule must be executed. The Jamfile to be queued may already exist, or it may be generated during the current pass or any previous pass.</p>
<h1><a class="anchor" id="multiple_passes_example1"></a>
Example 1</h1>
<p> <blockquote>  </p><div class="fragment"><div class="line"><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"># Jamfile.jam</span></div>
<div class="line"><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"># If run without the Jambase, set the &#39;all&#39; and &#39;clean&#39; targets to be</span></div>
<div class="line"><span class="preprocessor"># pseudotargets.  If &#39;clean&#39; isn&#39;t a pseudotarget, then Jam considers it</span></div>
<div class="line"><span class="preprocessor"># a file.  When using the &#39;clean&#39; target, it will have the appearance</span></div>
<div class="line"><span class="preprocessor"># of working in the multipass system, because it is always missing.</span></div>
<div class="line">NotFile all clean ;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Queue Pass2.jam up for the next pass.</span></div>
<div class="line"><span class="preprocessor">QueueJamfile Pass2.jam ;</span></div>
</div><!-- fragment --><p>  </blockquote> </p>
<p> <blockquote>  </p><div class="fragment"><div class="line"><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"># Pass2.jam</span></div>
<div class="line"><span class="preprocessor">###############################################################################</span></div>
<div class="line">Echo Pass 2 ;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Use the silly syntax for writing a file to the disk in an action.</span></div>
<div class="line"><span class="preprocessor"># I hope to revamp this soon.</span></div>
<div class="line">actions WriteFile</div>
<div class="line">{</div>
<div class="line">    ^^($(1)|$(CONTENTS)) ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Insert Pass3.jam into the &#39;all&#39; target.  If it isn&#39;t there, the file</span></div>
<div class="line"><span class="preprocessor"># won&#39;t get generated, but QueueJamfile will attempt to run it anyway,</span></div>
<div class="line"><span class="preprocessor"># resulting in an error.</span></div>
<div class="line">Depends all : Pass3.jam ;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set the contents of Pass3.jam.  The Clean instruction is put directly</span></div>
<div class="line"><span class="preprocessor"># in Pass3.jam.  It can&#39;t exist before Pass3.jam exists, or Jam will</span></div>
<div class="line"><span class="preprocessor"># simply report an error when trying to delete the file.</span></div>
<div class="line">CONTENTS on Pass3.jam = <span class="stringliteral">&quot;Echo Pass 3 written ;</span></div>
<div class="line"><span class="stringliteral">Clean clean : Pass3.jam ;</span></div>
<div class="line"><span class="stringliteral">&quot;</span> ;</div>
<div class="line"></div>
<div class="line">WriteFile Pass3.jam ;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Without the Always, any changes to CONTENTS will not be written.  The</span></div>
<div class="line"><span class="preprocessor"># only time Pass3.jam will be written is when it doesn&#39;t exist.  An</span></div>
<div class="line"><span class="preprocessor"># alternative way to do this would be to enable the dependency cache and</span></div>
<div class="line"><span class="preprocessor"># UseCommandLine Pass3.jam : [ on Pass3.jam Var CONTENTS ] ;</span></div>
<div class="line">Always Pass3.jam ;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Queue the generated Pass3.jam.  It will have been written by the time</span></div>
<div class="line"><span class="preprocessor"># JamPlus&#39; multipass Jamfile reader kicks in.</span></div>
<div class="line"><span class="preprocessor">QueueJamfile Pass3.jam ;</span></div>
</div><!-- fragment --><p>  </blockquote> </p>
<h1><a class="anchor" id="multiple_passes_gotchas"></a>
Gotchas</h1>
<p>Multiple passes are filled with "gotchas" or, at the very least, more complexity. Thoughts on this are listed below.</p>
<p>When a build is initiated and a target specified on the command line, the target must exist in the dependency graph. If the target is not in the dependency graph, the build system won't know what to do. </p>
</div></div><!-- contents -->
</body>
</html>

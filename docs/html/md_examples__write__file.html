<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JamPlus manual: Examples Write File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript">
    DoxygenAwesomeTabs.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JamPlus manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_examples__write__file.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Examples Write File</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="examples_write_file_overview"></a>
Writing a file</h1>
<p>The following are various methods to write a file within Jam.</p>
<hr  />
 <h1><a class="anchor" id="examples_write_file_1"></a>
Write a file with a custom action</h1>
<p>Copy the following to a <code>Jamfile.jam</code> file.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo My custom file &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><p>Note that <code>$(1)</code> ends up being the filename <code>file.txt</code>, so the <code>echo</code> line will end up writing <code>My custom file</code> to <code>file.txt</code>.</p>
<p>If we run Jam at this point, <code>file.txt</code> will not be written:</p>
<div class="fragment"><div class="line">&gt; jam</div>
<div class="line">*** found 1 target(s)...</div>
</div><!-- fragment --><p><code>file.txt</code> is not in the dependency chain yet, so it won't be automatically build. It can be written by running <em>jam</em> with the target name:</p>
<div class="fragment"><div class="line">&gt; jam file.txt</div>
<div class="line">*** found 1 target(s)...</div>
<div class="line">*** updating 1 target(s)...</div>
<div class="line">@ WriteOneLineCustomFile file.txt</div>
<div class="line">*** updated 1 target(s)...</div>
</div><!-- fragment --><p>Building with <em>jam</em> again does no additional work:</p>
<div class="fragment"><div class="line">&gt; jam file.txt</div>
<div class="line">*** found 1 target(s)...</div>
</div><!-- fragment --><p>It would be nice if we could run jam without specifying the <code>file.txt</code> target. We can throw it into the <code>all</code> dependency chain to make this happen, since <code>all</code> is the default target when <em>jam</em> is run without arguments.</p>
<p>Add a <a class="el" href="builtin_rules.html#rule_Depends">Depends</a> call to <code>Jamfile.jam</code>.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo My custom file &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><p>Jam informs us that the target count has gone up, but nothing builds. The file is already there on disk from the last time we ran <em>jam</em>.</p>
<div class="fragment"><div class="line">&gt; jam</div>
<div class="line">*** found 2 target(s)...</div>
</div><!-- fragment --><p>There is a target called <code>clean</code> that will remove anything it depends on from the disk. If <code>file.txt</code> is added to the <code>clean</code> target, then running <code>jam clean</code> will remove <code>file.txt</code>:</p>
<p>Change <code>Jamfile.jam</code> to:</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo My custom file &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><p>Then clean up the already existing <code>file.txt</code> by running <em>jam</em> with the <code>clean</code> target.</p>
<div class="fragment"><div class="line"># Shell</div>
<div class="line">&gt; jam clean</div>
<div class="line">*** found 2 target(s)...</div>
<div class="line">*** updating 1 target(s)...</div>
<div class="line">@ Clean clean</div>
<div class="line">*** updated 1 target(s)...</div>
</div><!-- fragment --><p>Run <em>jam</em> again without a target to cause <code>file.txt</code> to be written to disk:</p>
<div class="fragment"><div class="line"># Shell</div>
<div class="line">&gt; jam</div>
<div class="line">*** found 2 target(s)...</div>
<div class="line">*** updating 1 target(s)...</div>
<div class="line">@ WriteOneLineCustomFile file.txt</div>
<div class="line">*** updated 1 target(s)...</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="examples_write_file_2"></a>
Write a file with changing content</h1>
<p>We need to write different text to the file in the <code>WriteOneLineCustomFile</code> rule, so the <code>WriteOneLineCustomFile</code> action is updated to this.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo My NEW custom file &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><p>And then running <em>Jam</em>:</p>
<div class="fragment"><div class="line"># Shell</div>
<div class="line">&gt; jam</div>
<div class="line">*** found 2 target(s)...</div>
</div><!-- fragment --><p>Nothing happened.</p>
<p>In <em>Jam</em>, changes to the script lines in actions are not factored into the build. Out of box, Jam performs build operations based on timestamps, but in this example, there are no timestamps to be considered. We have to tell <em>Jam</em> the action changed in another way.</p>
<p>The <a class="el" href="builtin_rules.html#rule_UseCommandLine">UseCommandLine</a> rule can be used for this. <code>UseCommandLine</code> adds user-defined data to the build calculations. If that user-defined data changes from one build to another, the target will be updated regardless of timestamps. Despite its name, <code>UseCommandLine</code> does not change the command line of any tool used in the build; it only performs additional dependency calculations.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo My NEW custom file &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line">UseCommandLine file.txt : update-to-version-2 ;</div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><p>Run <em>jam</em>:</p>
<div class="fragment"><div class="line">&gt; jam</div>
<div class="line">*** found 2 target(s)...</div>
<div class="line">*** updating 1 target(s)...</div>
<div class="line">@ WriteOneLineCustomFile file.txt</div>
<div class="line">*** updated 1 target(s)...</div>
</div><!-- fragment --><p>Good. <code>file.txt</code> gets updated.</p>
<p>Any time a change is made to the text in <code>WriteOneLineCustomFile</code>, we should also update the <code>UseCommandLine</code> version to get it to build.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo My even NEWER custom file &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line">UseCommandLine file.txt : update-to-version-3 ;</div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><p>This feels, though, as if mistakes could be made frequently. We can build a better approach and make <code>WriteOneLineCustomFile</code> more reusable in the process:</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line"># ONE_LINE_CONTENT is a setting assigned to the target in $(1)</div>
<div class="line">actions WriteOneLineCustomFile</div>
<div class="line">{</div>
<div class="line">    echo $(ONE_LINE_CONTENT) &gt; $(1)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line"> </div>
<div class="line"># Assign local variable &#39;content&#39; with the text to write to the file.</div>
<div class="line">local content = &quot;My newest best custom file&quot; ;</div>
<div class="line"> </div>
<div class="line"># Use &#39;content&#39; in the build calculation.</div>
<div class="line">UseCommandLine file.txt : $(content) ;</div>
<div class="line"> </div>
<div class="line"># Assign the setting ONE_LINE_CONTENT to the file.txt target.</div>
<div class="line">ONE_LINE_CONTENT on file.txt = $(content) ;</div>
<div class="line">WriteOneLineCustomFile file.txt ;</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="examples_write_file_3"></a>
Writing larger text files</h1>
<p>Within <code>WriteOneLineCustomFile</code>, we are only writing a single line of content. Jam's list expansion features could be used to automatically expand the "echo" lines into as many as we provide, but it is ugly. A better way is to use the special expansion syntax for writing files. In <code>Jambase.jam</code>, this syntax is hidden within rule <a class="el" href="jambase_rules.html#actions_WriteFile">WriteFile</a>.</p>
<div class="fragment"><div class="line">actions WriteFile</div>
<div class="line">{</div>
<div class="line">    ^^($(1)|$(CONTENTS:J=))</div>
<div class="line">}</div>
</div><!-- fragment --><p>We can use this to write multiple lines to the file:</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line"> </div>
<div class="line">local contents = &quot;My newest custom file with WriteFileContents</div>
<div class="line">    This one has multiple lines.</div>
<div class="line">    Line #3</div>
<div class="line">&quot; ;</div>
<div class="line">UseCommandLine file.txt : $(contents) ;</div>
<div class="line">CONTENTS on file.txt = $(contents) ;</div>
<div class="line">WriteFile file.txt ;</div>
</div><!-- fragment --><p>In fact, Jam provides <a class="el" href="jambase_rules.html#rule_WriteFileContents">WriteFileContents</a> to make this as easy to use as possible:</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">Depends all : file.txt ;</div>
<div class="line">Clean clean : file.txt ;</div>
<div class="line">WriteFileContents file.txt : &quot;My newest custom file with WriteFileContents</div>
<div class="line">    This one has multiple lines.</div>
<div class="line">    Line #3</div>
<div class="line">&quot; ;</div>
</div><!-- fragment --><p>In all cases, changing the content will result in Jam updating the generated target <code>file.txt</code>.</p>
<hr  />
<h1><a class="anchor" id="examples_write_file_5"></a>
Refactoring the build script</h1>
<p>Using <code>file.txt</code> everywhere gets harder and harder to maintain.</p>
<p>Let's swap it out for a variable instead:</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">local target = file.txt ;</div>
<div class="line">Depends all : $(target) ;</div>
<div class="line">Clean clean : $(target) ;</div>
<div class="line">WriteFileContents $(target) : &quot;Refactoring in progress.&quot; ;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="examples_write_file_6"></a>
Writing the target file to a directory</h1>
<p>When the target needs to be written into another directory, Jam provides a couple different approaches to this.</p>
<p>The easiest is to use the <a class="el" href="jambase_rules.html#rule_MakeLocate">MakeLocate</a> rule to have Jam add a dependency on the directory the target is to be written into. Jam will check first whether the directory exists. If it doesn't, the directory will be created and then the target file can be written.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">local target = file.txt ;</div>
<div class="line">Depends all : $(target) ;</div>
<div class="line">Clean clean : $(target) ;</div>
<div class="line">MakeLocate $(target) : the/output/directory ;</div>
<div class="line">WriteFileContents $(target) : &quot;Written into the/output/directory/file.txt&quot; ;</div>
</div><!-- fragment --><p>Make note that the <code>target</code> is still <code>file.txt</code>. The directory that <code>file.txt</code> is to be put in, <code>the/output/directory</code>, is assigned to <code>file.txt</code>'s <code>LOCATE</code> setting. This keeps the target name clean and allows simple reassignment of the output directory via <code>LOCATE</code>. See <a class="el" href="builtin_variables.html#built_in_variables_binding_binding_search_locate">the documentation for LOCATE</a> for more information.</p>
<p><code>target</code> can also be a full relative or absolute path. We just have to call <code>MakeLocate</code> with the <code>combine</code> option.</p>
<div class="fragment"><div class="line"># Jamfile.jam</div>
<div class="line">local target = the/output/directory/file.txt ;</div>
<div class="line">Depends all : $(target) ;</div>
<div class="line">Clean clean : $(target) ;</div>
<div class="line"># MakeLocate options are specified in the third parameter. We don&#39;t have any</div>
<div class="line"># directory overrides to fill in, so the second parameter is empty.</div>
<div class="line">#   MakeLocate $(target) : **EMPTY_HERE** : combine ;</div>
<div class="line">MakeLocate $(target) : : combine ;</div>
<div class="line">WriteFileContents $(target) : &quot;Written into the/output/directory/file.txt&quot; ;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>C Module Multiple Toolchain Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">C Module Multiple Toolchain Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="module_c_multiple_toolchain_support_overview"></a>
Overview</h1>
<p>Accessing the C module for the first time will auto-launch a reasonable default toolchain. On Windows, for example, the default toolchain is <code>win64/release</code>. You can override the default toolchain by passing the <code>C.TOOLCHAIN=platform/config</code> command-line option to Jam. For instance, to build win64 debug for the C toolchain, you would specify <code>C.TOOLCHAIN=win64/debug</code> on the Jam command-line.</p>
<div class="fragment"><div class="line">jam C.TOOLCHAIN=win64/debug</div></div><!-- fragment --><p>Additionally, as a backward compatibility feature, passing <code>PLATFORM=abc</code> and <code>CONFIG=defg</code> will result in a toolchain called <code>abc/defg</code>.</p>
<div class="fragment"><div class="line">jam PLATFORM=abc CONFIG=defg</div><div class="line"></div><div class="line"><span class="preprocessor"># This is the same as:</span></div><div class="line"><span class="preprocessor">#</span></div><div class="line"><span class="preprocessor">#     jam C.TOOLCHAIN=abc/defg</span></div></div><!-- fragment --><p><a class="el" href="module_c.html#rule_C_Toolchain">rule C.Toolchain TOOLCHAIN_SPEC</a> allows the current toolchain to be changed. The format of <code>TOOLCHAIN_SPEC</code> (<code>win32/release</code>) is slash-separated and the format is determined by the underlying Jamfiles that are executed. Additionally, at the end of the <code>TOOLCHAIN_SPEC</code>, you can add <code>key=value</code> options by preceding the option with an <code>@</code> sign. See <code>samples/toolchains-helloworld/Jamfile.jam</code> for usages.</p>
<div class="fragment"><div class="line">C.Toolchain win32/release ;</div><div class="line">C.Toolchain win32/release@C.COMPILER=mingw</div><div class="line">C.Toolchain win32@C.COMPILER=gcc@C.CONFIG=debug</div></div><!-- fragment --><h1><a class="anchor" id="module_c_multiple_toolchain_support_usage"></a>
Usage</h1>
<p>Saving and restoring the current toolchain is performed by storing off <code>$(C.ACTIVE_TOOLCHAIN_SPEC)</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Save the active toolchain.</span></div><div class="line">local saveActiveToolchainSpec = $(C.ACTIVE_TOOLCHAIN_SPEC) ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Change to another toolchain.</span></div><div class="line">C.Toolchain whatever/toolchain ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Do some work with the toolchain here.</span></div><div class="line">...</div><div class="line"></div><div class="line"># All done. Restore the previous one.</div><div class="line">C.Toolchain $(saveActiveToolchainSpec) ;</div></div><!-- fragment --><h1><a class="anchor" id="module_c_multiple_toolchain_support_example"></a>
Example</h1>
<p>For the following <code>Jamfile.jam</code>, a single invocation of Jam will build helloworld for:</p>
<ol type="1">
<li>The default toolchain</li>
<li>win32/release for the default compiler</li>
<li>win32/release for Visual C++ 2010</li>
<li>win32/release for Visual C++ 2012</li>
<li>win32/release for Visual C++ 2013</li>
<li>win32/release for MinGW</li>
<li>win32/debug for Visual C++ 2013</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor"># Build helloworld with the default toolchain or passed-in command-line toolchain.</span></div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=release for the default compiler.</span></div><div class="line">C.Toolchain win32@C.CONFIG=release ;</div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=release for VS2010.</span></div><div class="line">C.Toolchain win32/release@C.COMPILER=vs2010 ;</div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=release for VS2012.</span></div><div class="line">C.Toolchain win32/release@C.COMPILER=vs2012 ;</div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=release for VS2013.</span></div><div class="line">C.Toolchain win32/release@C.COMPILER=vs2013 ;</div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=release for MinGW.</span></div><div class="line">C.Toolchain win32/release@C.COMPILER=mingw ;</div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=debug for VS2013.</span></div><div class="line">C.Toolchain win32/debug@C.COMPILER=vs2013 ;</div><div class="line">C.Application helloworld : main.c ;</div><div class="line"></div><div class="line"><span class="preprocessor"># Build helloworld for C.PLATFORM=win32 and C.CONFIG=debug for VS2013. This will be a no-op.</span></div><div class="line">C.Toolchain win32@C.COMPILER=vs2013@C.CONFIG=debug ;</div><div class="line">C.Application helloworld : main.c ;</div></div><!-- fragment --><h1><a class="anchor" id="module_c_multiple_toolchain_support_technical_details"></a>
Technical Details</h1>
<p>The order of toolchain file loads is as follows when <code>C.Toolchain win32/release</code> is called:</p>
<ol type="1">
<li>The <code>C.Toolchain</code> rule is requested. The rule is found missing, so Jam loads <code>bin/modules/c.jam</code> to find it.</li>
<li>Jam then attempts to execute an unloaded rule called <code>C.Toolchain.win32.release</code>. The <code>FindMissingRule</code> support kicks in and ends up executing <code>rule C.Toolchain.win32.*</code> from <code>bin/modules/c/toolchain/win32.jam</code>.</li>
<li>Toolchain spec keys are added for <code>C.PLATFORM/PLATFORM</code> and <code>C.CONFIG/CONFIG</code>. For the toolchain <code>win32/release</code>, the following assignments are made: <code>C.PLATFORM=win32</code>, <code>PLATFORM=win32</code>, <code>C.CONFIG=release</code>, <code>CONFIG=release</code></li>
<li>Within <code>C.Toolchain.win32.*</code>, auto detection of the compiler is performed. First, the latest Visual Studio version is detected. Failing that, TDM/GCC is detected then MinGW. Assuming Visual Studio detection, <code>C.Toolchain.vc.win32.Detect</code> from <code>bin/modules/c/toolchain/vc/win32.jam</code> is called.</li>
<li>Next, <code>C.Toolchain.vc.win32-release</code> from <code>bin/modules/c/toolchain/vc/win32-release.jam</code> is called to set up some optimization flags and #defines.</li>
</ol>
<p><code>samples/fakeps3/jam/c/toolchain/fakeps3.jam</code> shows an example of handling multiple configurations and architectures within a single file.</p>
<div class="fragment"><div class="line">jam C.TOOLCHAIN=fakeps3/debug/ppu</div></div><!-- fragment --><p><code>C.ToolchainSpecKeys</code> is used to break down the basic form of <code>C.TOOLCHAIN=whatever/whatever</code>. It parses the <code>/</code> separators to assign the same value to multiple keys. For instance, <code>C.ToolchainSpecKeys C.PLATFORM/PLATFORM</code> assigns the value to both <code>C.PLATFORM</code> and <code>PLATFORM</code>.</p>
<div class="fragment"><div class="line">C.ToolchainSpecKeys C.PLATFORM/PLATFORM C.CONFIG/CONFIG ;</div></div><!-- fragment --><p>Settings are now added to <code>$(C.COMPILER_SUITE_SYMBOL)</code> with the rule names that should be called. More than one rule name can be attached per setting; the listed rules will executed in order. The names of the settings are as follows:</p>
<ul>
<li><code>C.ApplicationFromObjects_CleanIntermediates</code></li>
<li><code>C.ApplicationFromObjects_LinkFlags</code></li>
<li><code>C.ApplicationFromObjects_PostBuild</code></li>
<li><code>C.ApplicationFromObjects_Setup</code></li>
<li><code>C.C++Exceptions</code></li>
<li><code>C.LibraryFromObjects_LibFlags</code></li>
<li><code>C.LinkPrebuiltLibraries</code></li>
<li><code>C.MultiCppCompile_PreCompile</code></li>
<li><code>C.MultiCppCompile_PchDeps</code></li>
<li><code>C.MultiCppCompile_PostCompile</code></li>
<li><code>C.MultiCppCompile_SetupFlags</code></li>
<li><code>C.RuntimeTypeHelper</code></li>
<li><code>C.SharedLibraryFromObjects_CleanIntermediates</code></li>
<li><code>C.SharedLibraryFromObjects_ExportLib</code></li>
<li><code>C.SharedLibraryFromObjects_LinkFlags</code></li>
<li><code>C.SharedLibraryFromObjects_PostBuild</code></li>
<li><code>C.SharedLibraryFromObjects_RegServer</code></li>
<li><code>C.SharedLibraryFromObjects_UnRegServer</code>.</li>
</ul>
<hr/>
 </div></div><!-- contents -->
</body>
</html>
